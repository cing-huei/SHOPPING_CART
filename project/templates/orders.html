<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ”¶ä»¶ç®¡ç†</title>   
    <link rel="stylesheet" href="{% static './orders.css' %}">
    <link rel="stylesheet" href="{% static './css/bootstrap.min.css' %}">
</head>
<body>
    <nav class="navbar navbar-light bg-rgb(255, 255, 235) navbar-expand-md" id="top-1">
        <div class="container-fluid">
            <div class="d-flex justify-content-end align-items-center d-md-inline d-none"></div>
            <div class="d-flex justify-content-center align-items-center">
                <p id="cart_text" class="d-md-inline">
                    <div>
                        {% if request.user.is_authenticated %}
                            <div>
                                <a href="/adminlogout/" id="sign_in">
                                    <img src="{% static './images/member4_0.png' %}" id="member" />{{ user.username }} / ç™»å‡º
                                </a>
                            </div>
                        {% else %}
                            <div>
                                <a href="/adminlogin/" id="sign_in">
                                    <img src="{% static './images/member4_0.png' %}" id="member" />ç™»å…¥
                                </a>
                            </div>
                        {% endif %}
                    </div>
                    <div class="dropdown" id="top-2" style="margin-left: 10px; margin-right: 80px;">
                        <a class="btn btn-second btn-md dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            åŠŸèƒ½
                        </a>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                            <a class="dropdown-item" href="/backgroundhome/">å¾Œå°é¦–é </a>
                            <a class="dropdown-item" href="/managementlist/">æ¬Šé™ç®¡ç†</a>
                            <a class="dropdown-item" href="/listall/">æœƒå“¡ç®¡ç†</a>
                            <a class="dropdown-item" href="#">å•†å“ç®¡ç†</a>
                            <a class="dropdown-item" href="/ordertable/">å•†å“è¨‚å–®</a>
                            <a class="dropdown-item" href="/inventorysheet/">åº«å­˜æŸ¥è©¢</a>
                        </div>
                    </div>
                </p>
            </div>
        </div>
    </nav>
    <div class="container">
        <div class="head_content text-center mt-3">
            <h1 class="title">æ”¶ä»¶ç®¡ç†</h1>
        </div>
    </div>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container d-flex justify-content-between align-items-center">
            <span class="navbar-text flex-grow-1 text-center">ç›®å‰çš„è³‡æ–™ç­†æ•¸: {{ resultList.count }}</span>
            <form class="form-inline d-flex" action="/orders/" method="post">
                <input class="form-control ml-auto" type="search" id="site_search" name="site_search" placeholder="ğŸ”è«‹è¼¸å…¥é—œéµå­—" >
                <button class="btn btn-outline-success" type="submit" id="btn_search">æœ å°‹</button>
                <button class="btn btn-outline-primary" type="button" id="btn_back" onclick="history.back()">è¿” å›</button>
            </form>
        </div>
    </nav>
       
    {% if status %}
        <table cellpadding="20" cellspacing="0"class="table table-striped table-hover" id="data-table">
            <tr>
                <th>ğŸ“è¨‚å–®ç·¨è™Ÿ</th>
                <th>âœï¸æœƒå“¡å§“å</th>
                <th>âœï¸æ”¶ä»¶è€…å§“å</th>
                <th>âœ†æ”¶ä»¶è€…æ‰‹æ©Ÿ</th>
                <th>âœ‰ä¿¡ç®±</th>
                <th>ğŸ’µå•†å“é‡‘é¡</th>
                <th>ğŸššé‹è²»</th>
                <th>ğŸ’²ç¸½é‡‘é¡</th>
                <th>ğŸš›ç‰©æµ</th>
                <th>ğŸ¡æ”¶ä»¶è€…åœ°å€</th>
                <th>ğŸ’°ä»˜æ¬¾æ–¹å¼</th>
                <th>â˜¹é»‘åå–®</th>
                <th>ğŸ› ï¸æ“ä½œ</th>
            </tr>
            {% for order in resultList %}
        <tr>
            <td>{{ order.id }}</td>
            <td>{{ order.customemail.Username }}</td>
            <td>{{ order.customname }}</td>
            <td>{{ order.customphone }}</td>
            <td>{{ order.customemail.Usermail }}</td>
            <td>{{ order.subtotal }}</td>
            <td>{{ order.shipping }}</td>
            <td>{{ order.grandtotal }}</td>
            <td>{{ order.shipping_method }}</td>
            <td>{{ order.customaddress }}</td>
            <td>{{ order.paytype }}</td>
            <td>
                {% if order.customemail.Isblacklisted %}
                    æ˜¯
                {% else %}
                    å¦
                {% endif %}
            </td>
            <td>
                <a href="/ordersedit/{{ order.id }}/"><button type="button" class="btn btn-outline-primary">âœšç·¨è¼¯</button></a>
                <a href="/ordersdelete/{{ order.id }}/"><button type="button" class="btn btn-outline-danger">âœ˜åˆªé™¤</button></a>
            </td>
        </tr>
        {% endfor %}
        </table>
        <nav aria-label="Page navigation example">
            <div class="d-flex justify-content-center">
                <ul class="pagination d-flex justify-content-center">
                    <li class="page-item" id="previousPage">
                        <a class="page-link" href="#" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                    <li class="page-item" id="page1"><a class="page-link" href="#">1</a></li>
                    <li class="page-item" id="page2"><a class="page-link" href="#">2</a></li>
                    <li class="page-item" id="page3"><a class="page-link" href="#">3</a></li>
                    <li class="page-item" id="nextPage">
                        <a class="page-link" href="#" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                </ul>
        
                {% comment %} ä¸‹æ‹‰é¸æ“‡æ¡† {% endcomment %}
                <div class="form-group d-flex  align-items-center">
                    <label for="pageSelect">ç¬¬</label>
                    <select class="form-control" id="pageSelect">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                    <label>é </label>
                </div>
            </div>
        </nav>
    {% else %}
        <h1>ç„¡è³‡æ–™</h1>
    {% endif %}
    <script>
        // ç²å–æ•¸æ“šç¸½æ•¸å’Œæ¯é é¡¯ç¤ºçš„æ•¸æ“šé‡
        var totalData = {{ resultList|length }};
        var itemsPerPage = 10; // æ¯é é¡¯ç¤º10æ¢æ•¸æ“š
    
        // è¨ˆç®—ç¸½é æ•¸
        var totalPages = Math.ceil(totalData / itemsPerPage);
    
        // åˆå§‹åŒ–ç•¶å‰é 
        var currentPage = 1;
    
        // æ¯æ¬¡åªé¡¯ç¤ºæœ€å¤šçš„é ç¢¼æ•¸ï¼ˆé€™è£¡è¨­ç‚º5ï¼‰
        var maxVisiblePages = 5;
    
        // ç²å–åˆ†é å…ƒç´ 
        var pagination = document.querySelector('.pagination');
        var previousPage = document.getElementById('previousPage');
        var nextPage = document.getElementById('nextPage');
        var pageSelect = document.getElementById('pageSelect');
    
        // æ›´æ–°åˆ†é å…ƒç´ çš„å¯è¦‹æ€§
        function updatePagination() {
            if (totalPages <= 1) {
                pagination.style.display = 'none';
            } else {
                pagination.style.display = 'block';
    
                // æ¸…ç©ºåˆ†é å…ƒç´ 
                pagination.innerHTML = '';
    
                // æ·»åŠ ä¸Šä¸€é éˆæ¥
                if (currentPage > 1) {
                    pagination.appendChild(createPageLink(currentPage - 1, 'Previous', '&laquo;'));
                }
    
                // è¨ˆç®—è¦é¡¯ç¤ºçš„é ç¢¼ç¯„åœ
                var startPage = Math.max(currentPage - Math.floor(maxVisiblePages / 2), 1);
                var endPage = Math.min(startPage + maxVisiblePages - 1, totalPages);

                // å¦‚æœæœ«å°¾é ç¢¼ä¸è¶³ maxVisiblePagesï¼Œå‰‡èª¿æ•´ startPage
                if (endPage - startPage + 1 < maxVisiblePages) {
                    startPage = Math.max(endPage - maxVisiblePages + 1, 1); // ç¡®ä¿ startPage ä¸å°äº1
                }
    
                // æ·»åŠ é ç¢¼éˆæ¥
                for (var i = startPage; i <= endPage; i++) {
                    pagination.appendChild(createPageLink(i, 'Page ' + i, i.toString()));
                }
    
                // æ·»åŠ ä¸‹ä¸€é éˆæ¥
                if (currentPage < totalPages) {
                    pagination.appendChild(createPageLink(currentPage + 1, 'Next', '&raquo;'));
                }
            }
    
            // æ›´æ–°ä¸‹æ‹‰é¸å–®çš„é¸é …
            updatePageSelect();
        }
    
        // Helper å‡½æ•¸ä¾†å‰µå»ºåˆ†é éˆæ¥
        function createPageLink(page, label, content) {
            var li = document.createElement('li');
            li.className = 'page-item';
            if (page === currentPage) {
                li.classList.add('active');
            }
            var a = document.createElement('a');
            a.className = 'page-link';
            a.href = '#';
            a.textContent = content;
            a.setAttribute('aria-label', label);
            a.addEventListener('click', function (e) {
                e.preventDefault();
                currentPage = page;
                updatePagination();
                updateTableVisibility();
            });
            li.appendChild(a);
            return li;
        }
    
        // Helper å‡½æ•¸ä¾†æ›´æ–°ä¸‹æ‹‰é¸å–®çš„é¸é …
        function updatePageSelect() {
            pageSelect.innerHTML = '';
            for (var i = 1; i <= totalPages; i++) {
                var option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                pageSelect.appendChild(option);
            }
            pageSelect.value = currentPage; // ç¢ºä¿ä¸‹æ‹‰é¸å–®é¡¯ç¤ºç•¶å‰é¸æ“‡çš„é é¢
        }
        
        // Helper å‡½æ•¸ä¾†å‰µå»ºåˆ†é éˆæ¥
        function createPageLink(page, label, content) {
            var li = document.createElement('li');
            li.className = 'page-item';
            if (page === currentPage) {
                li.classList.add('active');
            }
            var a = document.createElement('a');
            a.className = 'page-link';
            a.href = '#';
            a.textContent = content;
            a.setAttribute('aria-label', label);

            // ä½¿ç”¨ Bootstrap 5 çš„å…§å»ºç¬¦è™Ÿ
            if (label === 'Previous') {
                a.innerHTML = '<span aria-hidden="true">&laquo;</span>';
            } else if (label === 'Next') {
                a.innerHTML = '<span aria-hidden="true">&raquo;</span>';
            }

            a.addEventListener('click', function (e) {
                e.preventDefault();
                currentPage = page;
                updatePagination();
                updateTableVisibility();
            });
            li.appendChild(a);
            return li;
        }

        // æ›´æ–°æ•¸æ“šè¡¨æ ¼çš„å¯è¦‹æ€§
        function updateTableVisibility() {
            var startIndex = (currentPage - 1) * itemsPerPage;
            var endIndex = Math.min(currentPage * itemsPerPage, totalData);
    
            var tableRows = document.querySelectorAll('#data-table tr');
            tableRows.forEach(function (row, index) {
                if (index === 0 || (index >= startIndex + 1 && index <= endIndex)) {
                    row.style.display = 'table-row';
                } else {
                    row.style.display = 'none';
                }
            });
        }
    
        // åˆå§‹åŒ–åˆ†é 
        updatePagination();
        updateTableVisibility();
    
        // é™„åŠ ä¸€å€‹äº‹ä»¶ç›£è½å™¨åˆ°pageSelectä¸‹æ‹‰æ¡†
        pageSelect.addEventListener('change', function() {
            // ç²å–æ‰€é¸é æ•¸
            var selectedPage = parseInt(pageSelect.value);
    
            // æ›´æ–°ç•¶å‰é æ•¸ä¸¦åˆ·æ–°å…§å®¹
            if (!isNaN(selectedPage) && selectedPage !== currentPage && selectedPage >= 1 && selectedPage <= totalPages) {
                currentPage = selectedPage;
                updatePagination();
                updateTableVisibility();
            }
        });
    </script>
    <script src="{% static './js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static './js/top.js' %}"></script>
</body>
</html>